---
import { Image } from "astro:assets";
import Logo from "../assets/name.png";
import { getLangFromUrl } from "../i18n/utils";
import { supabase } from "../lib/supabase";
import GalleyEditor from './Gallery/GalleyEditor.astro';
import MenuEditor from './Menu/MenuEditor.astro';

const lang = getLangFromUrl(Astro.url);

const {
  data: { user },
} = await supabase.auth.getUser();
---

<!-- <script>
  document.addEventListener("DOMContentLoaded", () => {
    const languageSwitcher = document.getElementById("languageSwitcher");

    // Add an event listener to handle language change
    languageSwitcher.addEventListener("change", (event: Event) => {
      const selectedLang = (event.target as HTMLSelectElement).value ?? "it";
      window.location.href =
        selectedLang === "it" ? `/dashboard` : `/${selectedLang}/dashboard`; // Redirect to the selected language page
    });
  });
</script> -->

<header
  class="sticky top-0 z-50 bg-white shadow-md flex items-center justify-between px-4 py-3"
>
  <a href="/"><Image src={Logo} alt="Sindia Logo" height={32} /></a>
  <div class="flex items-center space-x-4">
    <!-- <select
      aria-label="Language Switcher"
      class="border-none bg-transparent font-body text-primary"
      value={lang}
      id="languageSwitcher"
    >
      <option value="en" selected={lang === "en"}>EN</option>
      <option value="it" selected={lang === "it"}>IT</option>
    </select> -->

    <div class="flex items-center gap-4">
      <div class="flex items-center gap-4">
        <!-- <Image src={user.user_metadata.picture} alt="" height={32} width={32} class="w-10 h-10 rounded-full" /> -->
        <div class="font-medium dark:text-white">
          <div>{user.user_metadata.full_name}</div>
          <div class="text-sm text-gray-500 dark:text-gray-400">
            {user.user_metadata.email}
          </div>
        </div>
      </div>

      <form action="/api/auth/signout">
        <button
          type="submit"
          class="rounded-md bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm transition-all
                 hover:bg-secondary hover:shadow-md focus-visible:outline focus-visible:outline-offset-2 focus-visible:outline-primary
                 font-body uppercase tracking-wider"
        >
          Sign Out
        </button>
      </form>
    </div>
  </div>
</header>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 font-['Poppins',_sans-serif]">
  <div class="bg-white rounded-lg shadow-md overflow-hidden">
    <div class="flex border-b border-gray-200">
      <button id="tab-images" class="px-8 py-4 text-[#b22222] font-['Cormorant_Garamond',_serif] text-lg font-semibold relative focus:outline-none">
        Galley
        <span class="absolute bottom-0 left-0 w-full h-1 bg-[#b22222]"></span>
      </button>
      <button id="tab-menu" class="px-8 py-4 text-gray-500 font-['Cormorant_Garamond',_serif] text-lg font-semibold relative focus:outline-none">
        Menu
      </button>
    </div>
    
    <div id="image-editor-section" class="p-8">
      <GalleyEditor />
    </div>
    
    <div id="menu-editor-section" class="p-8 hidden">
      <MenuEditor />
    </div>
  </div>
</div>

<script>
  // Tab switching functionality
  const tabImages = document.getElementById('tab-images');
  const tabMenu = document.getElementById('tab-menu');
  const imageEditorSection = document.getElementById('image-editor-section');
  const menuEditorSection = document.getElementById('menu-editor-section');

  tabImages.addEventListener('click', () => {
    // Update tab styles
    tabImages.classList.add('text-[#b22222]');
    tabImages.classList.remove('text-gray-500');
    tabMenu.classList.add('text-gray-500');
    tabMenu.classList.remove('text-[#b22222]');
    
    // Show/hide content
    imageEditorSection.classList.remove('hidden');
    menuEditorSection.classList.add('hidden');
    
    // Add/remove indicator line
    if (!tabImages.querySelector('span')) {
      const indicator = document.createElement('span');
      indicator.className = 'absolute bottom-0 left-0 w-full h-1 bg-[#b22222]';
      tabImages.appendChild(indicator);
    }
    
    const menuIndicator = tabMenu.querySelector('span');
    if (menuIndicator) {
      menuIndicator.remove();
    }
  });

  tabMenu.addEventListener('click', () => {
    // Update tab styles
    tabMenu.classList.add('text-[#b22222]');
    tabMenu.classList.remove('text-gray-500');
    tabImages.classList.add('text-gray-500');
    tabImages.classList.remove('text-[#b22222]');
    
    // Show/hide content
    menuEditorSection.classList.remove('hidden');
    imageEditorSection.classList.add('hidden');
    
    // Add/remove indicator line
    if (!tabMenu.querySelector('span')) {
      const indicator = document.createElement('span');
      indicator.className = 'absolute bottom-0 left-0 w-full h-1 bg-[#b22222]';
      tabMenu.appendChild(indicator);
    }
    
    const imagesIndicator = tabImages.querySelector('span');
    if (imagesIndicator) {
      imagesIndicator.remove();
    }
  });
</script>